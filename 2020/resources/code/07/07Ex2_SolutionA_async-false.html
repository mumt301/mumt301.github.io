<html>
    <head>
        <title>In-class Exercise 2</title>
        <link rel="stylesheet" href="https://minicss.org/flavorFiles/mini-default.css">
        <meta name="viewport" content="width=device-width, initial-scale=1"> 
    </head>
    <body>
        <h1>In-class Exercise 2</h1>

        <!-- The form -->
        <form>
            <label for="n1">City:</label>
            <input type="text" name="city" id="n1">
            <input type="submit">
        </form>

        <!-- The empty element to put the results -->
        <p id="theresult"></p>

        <!-- Disclaimer:
            For convenience, we have the JavaScript contained in the HTML file.
            However, it is always better to separate them in two files 
            (one for HTML and another file for JavaScript, 
            and reference the JavaScript file in the <script> tag of the HTML file). -->
        <script>
            function generate_results() {
                // Extracting the data from the form
                let params = (new URL(document.location)).searchParams;
                if (params.has("city")){
                    let city = params.get("city");
                    console.log(city);
                    // Filling-in the placeholder element (finished later - see step 3)
                    let placeholder = document.getElementById('theresult');
                    //placeholder.innerHTML = "The city you are searching for is: " + city;
                    
                    // Exercise # 2 - Beginning
                    let queryURL = `http://api.openweathermap.org/data/2.5/weather?q=${city}&APPID=84333ed1e3b5de0a85ebd078cd8f713c&mode=xml`;
                    console.log(queryURL);

                    // 1. Making the query
                    retrievedData = httpGet(queryURL); // function defined below
                    console.log(retrievedData);

                    // 2. Data parsing
                    // (can try this in the console, the retrievedData XML document object has similar
                    // methods as an HTML document object: 'getElementById', 'getElementsByTagName')
                    temperature = retrievedData.getElementsByTagName("temperature")[0];
                    currentTemperature = temperature.getAttribute("value");
                    scaleTemperature = temperature.getAttribute("unit");
                    retrievedCity = retrievedData.getElementsByTagName("city")[0].getAttribute("name");
                    sky = retrievedData.getElementsByTagName("weather")[0].getAttribute("value");
    
                    // 3. Rendering data
                    placeholder.innerHTML =
                        "Current temperature and conditions for " +
                        retrievedCity + " now are: " +
                        currentTemperature + " in " + scaleTemperature + " with " + sky;
                }
            }
            function httpGet(theUrl) {
                // Function to make the HTTP request (uses XMLHttpRequest object)
                // The XMLHttpRequest object can be used to exchange data with a web server 
                // behind the scenes (https://www.w3schools.com/js/js_ajax_http.asp, see last two tables)
                var xmlHttp = new XMLHttpRequest(); // Create an XMLHttpRequest object
                xmlHttp.open("GET", theUrl, false); // Set the request method, request URL, and synchronous flag (async)
                xmlHttp.send(); // Initiates (sends) the request
                return xmlHttp.responseXML; // Returns the response as document (XML data)
            }
            window.onload = generate_results();
        </script>

    </body>
</html>
